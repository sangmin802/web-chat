## ðŸ‘ web-socket

- socket.io
- React.js
- node.js
- gh-pages
- heroku

## ðŸŽ server express + socket.io

- [web-chat-server](https://github.com/sangmin802/web-chat-server)

## ðŸ– socket.io ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ê°¯ìˆ˜

### ðŸ» 2ê°œ

1. `/loby`
2. `/rooms`

### ðŸº 1ê°œ

1. `/chat`

- ë³¸ëž˜ëŠ” ë‘ê°œì˜ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ë¡œ `loby`ì™€ `rooms` ì˜ `socket.io` ì„œë²„ë¥¼ êµ¬ë¶„í•  ê¹Œ í•˜ë‹¤ê°€, ê·¸ëƒ¥ í•˜ë‚˜ì˜ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ê³  `loby` ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ì‹œ, ì „ì²´ì±„íŒ… ì´ë²¤íŠ¸ì— ëŒ€í•œ ì—°ê²°ì„ ì·¨ì†Œí•˜ê³ , ê·“ì†ë§ì„ ìœ„í•œ `userID room`ì„ `leave` í•˜ëŠ”ê²Œ ë” ë‚˜ì„ë“¯ í•¨.

## ðŸ“ êµ¬ì¡°

- ðŸ”´ : ì„œë²„
- ðŸ”µ : í´ë¼ì´ì–¸íŠ¸

### ðŸ­ log-in

- ì‚¬ìš©ìžì˜ ì•„ì´ë””ë¥¼ ì§€ì •í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

### ðŸ¥ loby

- ìœ ì €ë¦¬ìŠ¤íŠ¸, ë°©ë¦¬ìŠ¤íŠ¸, ì „ì²´ì±„íŒ…Â·ê·“ì†ë§ ë‚´ìš© ì¶œë ¥
- ëª¨ë“  ìœ ì €ì™€ ì „ì²´ì±„íŒ…ì„ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
- íŠ¹ì • ìœ ì €ì™€ ê·“ì†ë§ì„ í•  ìˆ˜ ìžˆëŠ” ì»´í¬ë„ŒíŠ¸
  > ë©”ì‹œì§€ ë‚´ìš©ì„ ë™ì¼í•œ `view`ì— ë…¸ì¶œì‹œí‚¤ì§€ë§Œ, ìƒ‰ìƒì„ ë‹¤ë¥´ê²Œ
- ê¸°ë³¸ `/`ì˜ `socket.io` ì„œë²„ê°€ ì•„ë‹Œ ì»¤ìŠ¤í…€ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ `/loby`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¥¼ ìƒì„±í•˜ë„ë¡ í•¨.
- ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ í•´ë‹¹ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ì„œë²„ëŠ” ì¢…ë£Œì‹œì¼œì„œ ìƒˆë¡œìš´ ë©”ì‹œì§€ ì•ŒëžŒì„ ë°›ì§€ ì•Šë„ë¡ í•¨
- `/loby` ì„œë²„ì—ì„œëŠ” ì‚¬ìš©ìžì˜ `userID`ë¥¼ `room`ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ì›í•˜ëŠ” `userID`ì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•  ìˆ˜ ìžˆë„ë¡ í•¨
  > `io.of('/loby').to(userID).emit`?
- ì „ì²´ì±„íŒ…ì˜ ê²½ìš° ëª¨ë“  ì‚¬ìš©ìžê°€ ë³¼ ìˆ˜ ìžˆë„ë¡ ë©”ì‹œì§€ ì „ë‹¬
  > `io.of('/loby').emit`?
- `loby` ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ, í•´ë‹¹ ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ì˜ ì„œë²„ì— ì ‘ì†í•œ ëª¨ë“  ìœ ì € ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°›ì•„ì™€ ì¢Œì¸¡ì— ì¶œë ¥
- `loby` ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ, `socket.io`ì˜ `/rooms` ë„¤ìž„ìŠ¤íŽ˜ì´ìŠ¤ ì„œë²„ì— ë“±ë¡ëœ ëª¨ë“  `room`ë“¤ì„ ë°›ì•„ì™€ ìš°ì¸¡ ìƒë‹¨ì— ì¶œë ¥
  > ë‚´ê°€ ì°¸ì—¬ì¤‘ì¸ ë°©ê³¼, ê°œì„¤ëœ ë°© êµ¬ë¶„
- ì°¸ì—¬ì¤‘ì¸ ë°©ì˜ ê²½ìš°, ìƒˆë¡œìš´ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ìƒˆë¡œìš´ ë©”ì‹œì§€ ê°¯ìˆ˜ ë…¸ì¶œ
  > ì¹´ì¹´ì˜¤í†¡ì²˜ëŸ¼
- ìƒì„±ë˜ì–´ìžˆëŠ” `room` í´ë¦­ ì‹œ, `/rooms` ì˜ roomì— `join`

  > `socket.join(room)`?

- [x] ðŸ”´ `socket middleware`ë¥¼ í†µí•´, `socket.id`ë¥¼ `socket.userID`ì™€ ë™ì¼í•˜ê²Œí•˜ì—¬ ì¶”í›„ `room`ì— `join`ì¤‘ì¸ `socket.id`ë¡œ `userStore`ë¥¼ ì¡°íšŒí•  ìˆ˜ ìžˆë„ë¡ í•¨

### ðŸ¥¯ room

- [x] ðŸ”µ ë°© ìƒì„±ì„ ìœ„í•´ `room` ìƒì„± ë²„íŠ¼ í´ë¦­

  - [x] ðŸ”µ `roomName` ì†ì„± ì§€ì • í›„ ì„œë²„ì˜ `create room` ì´ë²¤íŠ¸ í˜¸ì¶œ
    > êµ¬í˜„ì— ìžˆì–´ì„œëŠ” ì¼ë‹¨ `roomID`ë¡œ `roomName` ëŒ€ì²´

- [x] ðŸ”´ `create room` ìˆ˜ì‹ 

  - [x] ðŸ”´ `room store class`ì— `room` ì •ë³´ ì¶”ê°€
  - [x] ðŸ”´ ëª¨ë“  ìœ ì €ì—ê²Œ ìƒì„±ëœ `room` ì •ë³´ ì „ë‹¬ì„ ìœ„í•œ `room created` í˜¸ì¶œ

```ts
// ëŒ€ëžµì ì¸ room êµ¬ì¡°
// í´ë¼ì´ì–¸íŠ¸ì—ì„œ roomsëŠ” new Mapìœ¼ë¡œ ê´€ë¦¬
interface room {
  creater: string;
  isJoined: boolean = false;
  roomID: string;
  roomName: string;
  hasNewMessages: 0;
}
```

- [x] ðŸ”µ `room created` ìˆ˜ì‹ 

  - [x] ðŸ”µ `room.creater`ê°€ `socket.userID`ì™€ ë™ì¼í•˜ë©´ `join room` ë°”ë¡œ í˜¸ì¶œ
  - [x] ðŸ”µ `rooms` ìƒíƒœê°’ì— í•´ë‹¹ `room` ì •ë³´ ì¶”ê°€

- [x] ðŸ”µ ë°©ì— ë“¤ì–´ê°€ê¸° ìœ„í•´ `join room` í˜¸ì¶œ

  - [x] ðŸ”µ ë§Œì•½ ì´ë¯¸ ì°¸ì—¬í•´ì„œ `isJoined : true` ë¼ë©´ `room-loby` ì»´í¬ë„ŒíŠ¸ë§Œ í™œì„±í™”
  - [x] ðŸ”µ `isJoined : false` ë¼ë©´ `join room socket event emit`

- [x] ðŸ”´ `join room` ìˆ˜ì‹ 

  - [x] ðŸ”´ í˜¸ì¶œí•œ `socket.userID`ëŠ” `socket.join(roomID)`ë¡œ ì°¸ê°€
  - [ ] ðŸ”´ í˜„ìž¬ í•´ë‹¹ `roomID`ì— ì ‘ì†ì¤‘ì¸ ë‹¤ë¥¸ `socket`ë“¤ì„ ì°¾ê³ , `userStore`ì—ì„œ ê²€ìƒ‰í•˜ì—¬ ì „ë‹¬
  - [x] ðŸ”´ ì¶”ê°€ëœ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ ì „ë‹¬. `join room` í˜¸ì¶œ
  - [x] ðŸ”´ í•´ë‹¹ `roomID`ì— ê°€ìž…í•œ ìœ ì €ë“¤ì—ê²Œë§Œ `.to('roomID').emit`ìœ¼ë¡œ ìž…ìž¥ ë©”ì‹œì§€ ì•Œë¦¼ `room message`

- [x] ðŸ”µ `join room` ìˆ˜ì‹ 

  - [x] ðŸ”µ `room`ì— ì ‘ì†í•œ `userID`ê°€ `socket.userID`ì™€ ë™ì¼, ì¦‰ ë‚˜ ì´ê³ , `isJoined : false`ìƒíƒœë¼ë©´ `isJoined : true`ë¡œ ë³€ê²½
  - [x] ðŸ”µ `room`ì— ì ‘ì†í•œ `userID`ê°€ `socket.userID`ì™€ ë™ì¼, ì¦‰ ë‚˜ë¼ë©´ `room-loby` ì»´í¬ë„ŒíŠ¸ í™œì„±í™”
  - [ ] ðŸ”µ `room` ì •ë³´ì— í˜„ìž¬ `join`ë˜ì–´ìžˆëŠ” `socket`ë“¤ì„ í• ë‹¹
  - [x] ðŸ”µ `rooms` ìƒíƒœê°’ì— í•´ë‹¹ `room` ì •ë³´ ì¶”ê°€

- [x] ðŸ”µ ë°© ë‚˜ê°€ê¸°.

  - [x] ðŸ”µ ë°© `join` ìƒíƒœëŠ” ìœ ì§€í•˜ë©°, ë¡œë¹„ë¡œë§Œ ì´ë™í•  ê²½ìš° `setRoom(null)`
  - [x] ðŸ”µ ë°© `join` ìƒíƒœ ìžì²´ë¥¼ í•´ì§€í•  ê²½ìš°, `roomID`ë¥¼ `leave rom` ì´ë²¤íŠ¸ë¡œ `emit`
  - [x] ðŸ”µ ë‚´ê°€ í•´ë‹¹ `room`ì˜ ìœ ì¼í•œ ì°¸ê°€ìžë¼ë©´ ë‚˜ê°€ê¸°ì™€ ë™ì‹œì— `delete room`
  - [x] ðŸ”´ `delete room` í˜¸ì¶œ ì‹œ, `roomStore`ì—ì„œ í•´ë‹¹ `room` ì œê±°í•œ ë’¤, ì œê±°í•œ `roomID` ë™ì¼í•œ ì´ë²¤íŠ¸ëª…ìœ¼ë¡œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬

- [x] ðŸ”´ `leave room` ìˆ˜ì‹ 

  - [x] ðŸ”´ í•´ë‹¹ `roomID`ì— ëŒ€í•œ `socket.leave` ì‹¤í–‰
  - [x] ðŸ”´ í‡´ìž¥í•œ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ ì •ë³´ `leave room` ì´ë²¤íŠ¸ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ ë°, í•´ë‹¹ `roomID`ì— í‡´ìž¥ì•Œë¦¼ ì „ë‹¬

- [x] ðŸ”µ `leave room` ìˆ˜ì‹ 

  - [x] ðŸ”µ í‡´ìž¥í•œ `userID`ê°€ ìžì‹ ì˜ `socket.userID`ì™€ ë™ì¼í•˜ê³  `isJoined : true`ìƒíƒœë¼ë©´ `isJoined : false`ë¡œ ë³€ê²½
  - [x] ðŸ”µ í•´ë‹¹ `room`ì˜ ì†ì„±ê°’ë“¤ ëª¨ë‘ ì´ˆê¸°í™”`(messages, hasNewMessages ...)`
  - [x] ðŸ”µ `rooms` ìƒíƒœê°’ ë³€ê²½. ë§Œì•½, `isJoined : false`ë¡œ ë°”ë€ í´ë¼ì´ì–¸íŠ¸ë¼ë©´, `room-loby`ì»´í¬ë„ŒíŠ¸ ë¹„í™œì„±í™”

- [x] ðŸ”µ `roomID`ì™€ í•¨ê»˜`room`ì— ë©”ì‹œì§€ ì „ë‹¬

- [x] ðŸ”´ `room message` ìˆ˜ì‹ 

  - [x] ðŸ”´ í•´ë‹¹ `roomID`ì— ë©”ì‹œì§€ ë‚´ìš© ì „ë‹¬. ë°œì‹ ìžëŠ” `socket.userID`

- [x] ðŸ”µ `room message` ìˆ˜ì‹ 

  - [x] ðŸ”µ í•´ë‹¹ `room`ì˜ `messages`ì— ì¶”ê°€
  - [x] ðŸ”µ í˜„ìž¬ ì„ íƒëœ `room`ì´ ì•„ë‹ˆë¼ë©´, `hasNewMessages` ì¹´ìš´íŒ…

- [x] ðŸ”´ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ, ëª¨ë“  `room`ì—ì„œ `leave` ë°, `leave room` ì•Œë¦¼
- [x] ðŸ”´ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ, ë‚˜ë§Œ ë‚¨ì•„ìžˆë˜ `room`ì´ì˜€ë‹¤ë©´, í•´ë‹¹ `room` ì‚­ì œ

## ë°œìƒí–ˆë˜ ë¬¸ì œ ë° í•´ê²°

### ì„œë²„ì˜ ì´ë²¤íŠ¸ í˜¸ì¶œ ë§¤ìš° ì§§ì€ì‹œê°„ë‚´ì— ì¤‘ì²©

- [x] ðŸ”´ ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ, ë‚˜ë§Œ ë‚¨ì•„ìžˆë˜ `room`ì´ì˜€ë‹¤ë©´, í•´ë‹¹ `room` ì‚­ì œ

í•´ë‹¹ ë¬¸ì œì— ìžˆì–´, ì—¬ëŸ¬ê°œì˜ ë°©ì´ ë™ì‹œì— ì§€ì›Œì§€ë„ë¡ í•œë‹¤ë©´ `socket.off`ë¥¼ í•˜ê³  ë‹¤ì‹œ ì´ë²¤íŠ¸ë¥¼ `socket.on` í•˜ëŠ” ì†ë„ê°€ ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” ì´ë²¤íŠ¸ ì†ë„ë¥¼ ë”°ë¼ê°€ì§ˆ ëª»í•˜ì—¬ ëª‡ëª‡ê°œëŠ” ë‚¨ëŠ” ìƒí™©ìž„

ë”°ë¼ì„œ, ì‹œê°„ ë‚´ì— ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ ìž‘ì—…ì„ ë©ˆì¶”ëŠ” `debounce`ì‚¬ìš©

- `delete room` íŒŒíŠ¸

```ts
// ëˆ„ì ëœ ìž‘ì—…ì„ ë°›ì•„ì™€ì„œ ì¼ê´„ ì²˜ë¦¬í•¨
const deleteRoom = useCallback(
  arr => {
    const newRooms: IRooms = {};
    const roomVals = Object.values(rooms);
    roomVals.forEach(room => {
      if (arr.includes(room.roomID)) return;
      newRooms[room.roomID] = room;
    });
    setRooms(newRooms);
  },
  [rooms, setRooms]
);

// ìž‘ì—…ì½œë°±í•¨ìˆ˜ì™€ ì‹œê°„ì„ ê°–ê³ ìžˆëŠ” debounce ë©”ì†Œë“œ ë°˜í™˜
const deleteDebounceAct = useMemo(() => debounce(deleteRoom, 20), [deleteRoom]);

useEffect(() => {
  // delete room í˜¸ì¶œë¡œ roomIDë¥¼ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ë©´ debounce í´ë¡œì ¸ì—ì„œ ìž‘ì—…ì„ ë°°ì—´ì— ë‹´ìŒ
  // setTimeoutìœ¼ë¡œ ì§€ì •í•œ ëŒ€ê¸°ì‹œê°„ ë‚´ì— ìƒˆë¡œìš´ ìš”ì²­ì´ ë“¤ì–´ì˜¨ë‹¤ë©´
  // ê¸°ì¡´ì˜ ê²ƒì€ clearTimeout í•˜ê³ , ë°°ì—´ì— ìƒˆ ìž‘ì—…ì„ ë‹´ê³  ë‹¤ì‹œ setTimoutëŒë¦¼
  // ì´í›„ ë°˜ë³µ
  socket.on("delete room", deleteDebounceAct);
  return () => {
    socket.off("delete room");
  };
}, [deleteDebounceAct]);
```

- `debounce` íŒŒíŠ¸

```ts
export function debounce(cb: any, t: number) {
  let timer: any;
  const arr: any[] = [];
  function debounceAct(work: any) {
    if (timer) {
      console.log("ìƒˆë¡œìš´ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ëŒ€ê¸°í•©ë‹ˆë‹¤");
      clearTimeout(timer);
    }
    arr.push(work);
    timer = setTimeout(() => {
      cb(arr);
    }, t);
  }
  return debounceAct;
}
```
