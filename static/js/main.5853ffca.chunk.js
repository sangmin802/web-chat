(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{52:function(e,n,o){},57:function(e,n,o){},88:function(e,n,o){"use strict";o.r(n);var s,r=o(1),t=o.n(r),a=o(43),c=o.n(a),i=o(3),u=o(10),l=(o(52),o(4)),d=o(0);var m,b=l.a.article(s||(s=Object(i.a)(["\n  width: 100%;\n  position: relative;\n  text-align: left;\n  color: ",";\n  cursor: ",";\n"])),(function(e){return["green","black","purple"][e.type]}),(function(e){return 2===e.type?"pointer":"normal"})),j=function(e){var n=e.chat,o=e.togglePrivateMessage,s=n.content,t=n.from,a=n.to,c=n.fromSelf,i=Object(r.useMemo)((function(){return a||t?a?c?["\ub2f9\uc2e0\uc774 ".concat(a.userName,"\uc5d0\uac8c"),2]:c?[null,1]:["".concat(null===t||void 0===t?void 0:t.userName,"\ub2d8\uc774 \ub2f9\uc2e0\uc5d0\uac8c"),2]:[null===t||void 0===t?void 0:t.userName,1]:["\uacf5\uc9c0",0]}),[t,a,c]),l=Object(u.a)(i,2),m=l[0],j=l[1],h=Object(r.useCallback)((function(){if(a&&t){var e=c?a.userID:t.userID;o(e)}}),[o,c,t,a]);return Object(d.jsxs)(b,{type:j,onClick:h,children:[Object(d.jsx)("b",{children:m})," : ",s]})};var h,O=l.a.section(m||(m=Object(i.a)(["\n  display: flex;\n  flex-direction: column;\n  .chats {\n    position: relative;\n    width: 100%;\n    height: calc(100% - 36.1px);\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-end;\n    padding: 0.4rem;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n  form {\n    position: relative;\n    width: 100%;\n    height: 36px;\n    background: #222;\n    display: flex;\n    align-items: center;\n    b {\n      display: inline-block;\n      width: 20%;\n      background-color: #222;\n      border-radius: 6px 0 0 6px;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      white-space: nowrap;\n      color: #fff;\n      padding-left: 0.3rem;\n      &.private-message {\n        color: rgba(245, 81, 226, 1);\n      }\n    }\n    input {\n      border: 0;\n      width: 70%;\n      padding: 0.2rem 0.4rem;\n      outline: none;\n      border-radius: 6px;\n    }\n    button {\n      border: 0;\n      background: none;\n      width: 10%;\n      color: #fff;\n      cursor: pointer;\n    }\n    * {\n      font-size: 0.9rem;\n    }\n  }\n"]))),f=function(e){var n=e.chats,o=e.sendMessage,s=e.joinedUser,t=e.togglePrivateMessage,a=Object(r.useRef)(null),c=Object(r.useCallback)((function(e){var n;e.preventDefault();var s=null===a||void 0===a||null===(n=a.current)||void 0===n?void 0:n.value;s&&(o(s),e.target[0].value="")}),[o]),i=Object(r.useCallback)((function(){var e,n=null!==(e=null===s||void 0===s?void 0:s.userID)&&void 0!==e?e:null;t(n)}),[t,s]);return Object(r.useEffect)((function(){var e=document.querySelector(".chats");null===e||void 0===e||e.scrollTo(0,e.scrollHeight)}),[n]),Object(d.jsxs)(O,{className:"chat-area",children:[Object(d.jsx)("div",{className:"chats",children:n.map((function(e,n){return Object(d.jsx)(j,{chat:e,togglePrivateMessage:t},"chat ".concat(n))}))}),Object(d.jsxs)("form",{onSubmit:c,children:[s&&Object(d.jsxs)("b",{className:"private-message",onClick:i,children:[s.userName," \uc5d0\uac8c"]}),!s&&Object(d.jsx)("b",{children:"\ubaa8\ub450\uc5d0\uac8c"}),Object(d.jsx)("input",{ref:a,type:"text"}),Object(d.jsx)("button",{children:"\uc785\ub825"})]})]})};var g,p,v=l.a.article(h||(h=Object(i.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-item: center;\n  ",";\n  padding: 0.2rem 0.4rem;\n  .messages-hasNewMessages {\n    background-color: purple;\n    padding: 0.1rem 0.3rem;\n    border-radius: 3px;\n    font-size: 0.85rem;\n  }\n"])),(function(e){return e.isTarget?"background-color : #fff; color : black":"background-color : transparent; color : #f2f2f2"})),D=function(e){var n=e.user,o=e.togglePrivateMessage,s=e.joinedUser,t=Object(r.useCallback)((function(){n.userID&&o(n.userID)}),[o,n]);return Object(d.jsxs)(v,{isTarget:n.userID===(null===s||void 0===s?void 0:s.userID),onClick:t,children:[Object(d.jsx)("div",{className:"user-name",children:n.userName}),n.messages&&0!==n.messages.hasNewMessages&&Object(d.jsx)("div",{className:"messages-hasNewMessages",children:n.messages.hasNewMessages})]})};var I,x=l.a.section(g||(g=Object(i.a)(["\n  width: 20%;\n  height: 100%;\n  overflow-y: scroll;\n  scrollbar-width: none;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  background: #222;\n"]))),w=l.a.section(p||(p=Object(i.a)(["\n  width: 80%;\n  height : 100%;\n  display: flex;\n  flex-direction: column;\n  .button-container {\n    display : flex;\n    justify-content : flex-end;\n    height : 30px;\n    button {\n      display: inline-block;\n      width: fit-content;\n      background: transparent;\n      border 1px solid #666;\n      border-radius : 3px;\n      padding : .1rem .3rem;\n      cursor : pointer;\n      margin-left : .3rem;\n    }\n  }\n"]))),R=function(e){var n;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(x,{className:"users",children:null===(n=e.users)||void 0===n?void 0:n.map((function(n){return Object(d.jsx)(D,{user:n,togglePrivateMessage:e.toggleJoinedUser,joinedUser:e.joinedUser},n.userID)}))}),Object(d.jsxs)(w,{children:[e.children,Object(d.jsx)(f,{chats:e.chats,sendMessage:e.sendMessage,joinedUser:e.joinedUser,togglePrivateMessage:e.toggleJoinedUser})]})]})};o(57);var N,k,y=l.a.article(I||(I=Object(i.a)(["\n  width : calc(98% / 3);\n  @media screen and (max-width: 600px) {\n    width: calc(98% / 2);\n  }\n  height : fit-content;\n  border : 1px solid;\n  border-color : ","}\n  border-radius : 3px;\n  margin-right : 1%;\n  padding : .2rem .4rem;\n  cursor : pointer;\n  * {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n  }\n  .room-info {\n    display : flex;\n    justify-content : space-between;\n    .room-hasNewMessages {\n      background-color: purple;\n      padding: 0.1rem 0.3rem;\n      border-radius: 3px;\n      font-size: 0.85rem;\n      color : white;\n    }\n  }\n"])),(function(e){return e.isJoined?"tomato":"#444"})),M=function(e){var n=e.room,o=e.enterRoom,s=e.joinRoom,t=Object(r.useCallback)((function(){if(n.isJoined)return o(n.roomID);s(n.roomID)}),[o,s,n]),a=Object(r.useMemo)((function(){return n.isJoined?[n.users[0].userName,n.users.length<2?null:n.users.length-1]:[null,null]}),[n.users,n.isJoined]),c=Object(u.a)(a,2),i=c[0],l=c[1];return Object(d.jsxs)(y,{className:"room",isJoined:n.isJoined,onClick:t,children:[Object(d.jsx)("div",{className:"room-name",children:n.roomName}),n.isJoined&&Object(d.jsxs)("div",{className:"room-info",children:[Object(d.jsxs)("div",{className:"room-users",children:[i," ",l&&"+".concat(l)]}),0!==n.hasNewMessages&&Object(d.jsx)("div",{className:"room-hasNewMessages",children:n.hasNewMessages})]}),!n.isJoined&&Object(d.jsx)("div",{children:"\ub300\ud654\ubc29\uc5d0 \ucc38\uc5ec\ud558\uc138\uc694!"})]})};function U(e){var n=e.users,o=e.chats,s=e.rooms,t=e.joinedUser,a=e.toggleJoinedUser,c=e.joinRoom,i=e.enterRoom,u=e.createRoom,l=e.sendMessage,m=Object(r.useMemo)((function(){return Object.values(s).sort((function(e){return e.isJoined?-1:0}))}),[s]),b=Object(r.useMemo)((function(){return Object.values(n).sort((function(e,n){return e.self?-1:n.self?1:e.messages.recent>n.messages.recent?-1:0}))}),[n]);return Object(d.jsx)(J,{children:Object(d.jsx)(R,{joinedUser:t,toggleJoinedUser:a,sendMessage:l,chats:o,users:b,children:Object(d.jsxs)(T,{children:[Object(d.jsx)("section",{className:"button-container",children:Object(d.jsx)("button",{onClick:u,children:"\ubc29 \ub9cc\ub4e4\uae30"})}),Object(d.jsx)("section",{className:"created-rooms",children:m.map((function(e){return Object(d.jsx)(M,{room:e,enterRoom:i,joinRoom:c},e.roomID)}))})]})})})}var E,C,S,J=l.a.section(N||(N=Object(i.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: 40%;\n  }\n"]))),T=l.a.section(k||(k=Object(i.a)(["\n  height: 60%;\n  padding: 0.5rem;\n  .created-rooms {\n    height: calc(99% - 30.1px);\n    padding-top: 0.5rem;\n    display: flex;\n    flex-wrap: wrap;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n"]))),_=t.a.memo(U),P=function(e){var n=e.connectSocket,o=Object(r.useRef)(null),s=Object(r.useCallback)((function(e){var s;e.preventDefault();var r=null===o||void 0===o||null===(s=o.current)||void 0===s?void 0:s.value;r&&n(r)}),[n,o]);return Object(d.jsxs)(L,{children:[Object(d.jsx)("h2",{children:"Web Chat"}),Object(d.jsxs)("form",{onSubmit:s,children:[Object(d.jsx)("input",{ref:o,type:"text",autoComplete:"off",placeholder:"user name..."}),Object(d.jsx)("button",{children:"\uc785\uc7a5"})]})]})},L=l.a.section(E||(E=Object(i.a)(["\n  width: 300px;\n  position: relative;\n  top: 30%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n\n  h2 {\n    text-align: center;\n  }\n  form {\n    border-bottom: 1px solid #222;\n    input {\n      display: inline-block;\n      width: 80%;\n      border: 0;\n      outline: none;\n      padding: 0.1rem 0.3rem;\n    }\n    button {\n      display: inline-block;\n      width: 20%;\n      padding: 0.1rem 0.3rem;\n      border: 0;\n      background: #222;\n      border-radius: 3px 3px 0 0;\n      color: #eee;\n    }\n  }\n"]))),A=t.a.memo(P);function G(e){var n=e.joinedRoom,o=e.joinedUser,s=e.leaveRoom,t=e.goLoby,a=e.toggleJoinedUser,c=e.sendMessage,i=Object(r.useCallback)((function(){s(n.roomID)}),[s,n]);return Object(d.jsx)(z,{children:Object(d.jsx)(R,{joinedUser:o,toggleJoinedUser:a,sendMessage:c,chats:n.messages,users:n.users,children:Object(d.jsx)(B,{children:Object(d.jsxs)("div",{className:"button-container",children:[Object(d.jsx)("button",{onClick:i,children:"\ub098\uac00\uae30"}),Object(d.jsx)("button",{onClick:t,children:"\ub85c\ube44\ub85c \uc774\ub3d9"})]})})})})}var z=l.a.section(C||(C=Object(i.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: calc(100% - 46.1px);\n  }\n"]))),B=l.a.section(S||(S=Object(i.a)(["\n  padding: 0.5rem;\n  height: fit-content;\n"]))),V=t.a.memo(G),q=o(47),F=Object(q.io)("https://web-chat-sangmin-server.herokuapp.com/web-chat",{autoConnect:!1});F.onAny((function(e){}));var H,W="USER_CONNECTED",K="USER_DISCONNECTED",Q="TOGGLE_JOINED_USER",X="LEAVE_ROOM",Y="JOIN_ROOM",Z="CREATE_ROOM",$="DELETE_ROOM",ee="ENTER_ROOM",ne="SET_USERS_ROOMS",oe="PRIVATE_MESSAGE",se="PUBLIC_MESSAGE",re="ROOM_MESSAGE",te=o(16),ae=o(11),ce=o(2),ie={chats:[],users:{},rooms:{},joinedRoomID:null,joinedUser:null};function ue(e,n){switch(n.type){case ne:var o=n.rooms,s=n.users,r={},t={};return o.forEach((function(n){e.rooms[n.roomID]&&(r[n.roomID]=e.rooms[n.roomID]),e.rooms[n.roomID]||(r[n.roomID]=n)})),s.forEach((function(n){e.users[n.userID]&&(t[n.userID]=e.users[n.userID]),e.users[n.userID]||(t[n.userID]=n)})),Object(ce.a)(Object(ce.a)({},e),{},{users:t,rooms:r,joinedRoomID:null});case ee:var a=n.roomID,c=Object(ce.a)({},e.rooms);return c[a]=Object(ce.a)(Object(ce.a)({},e.rooms[a]),{},{hasNewMessages:0}),Object(ce.a)(Object(ce.a)({},e),{},{rooms:c,joinedRoomID:a});case Y:var i=n.roomID,u=n.userID,l=n.roomUsers,d=n.userName,m=Object(ce.a)({},e.rooms[i]),b=F.userID===u;m.isJoined=!0;var j=l.map((function(e){return e.self=!1,e.userID===F.userID&&(e.self=!0),e}));m.users=j,m.messages.push({content:"".concat(d,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")});var h=Object(ce.a)(Object(ce.a)({},e.rooms),{},Object(ae.a)({},i,m));return Object(ce.a)(Object(ce.a)({},e),{},{rooms:h,joinedRoomID:b?i:e.joinedRoomID});case X:var O=n.roomID,f=n.roomUsers,g=n.userID,p=n.userName,v=n.users,D=n.rooms;if(F.userID===g){var I={},x={};return D.forEach((function(n){e.rooms[n.roomID]&&(I[n.roomID]=e.rooms[n.roomID]),e.rooms[n.roomID]||(I[n.roomID]=n)})),v.forEach((function(n){e.users[n.userID]&&(x[n.userID]=e.users[n.userID]),e.users[n.userID]||(x[n.userID]=n)})),Object(ce.a)(Object(ce.a)({},e),{},{rooms:I,users:x,joinedRoomID:null})}var w=Object(ce.a)({},e.rooms[O]);w.users=f,w.messages.push({content:"".concat(p,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")});var R=Object(ce.a)(Object(ce.a)({},e.rooms),{},Object(ae.a)({},O,w));return Object(ce.a)(Object(ce.a)({},e),{},{rooms:R});case re:var N=n.message,k=n.roomID,y=Object(ce.a)({},e.rooms[k]);y.messages.push(N),e.joinedRoomID||y.hasNewMessages++;var M=Object(ce.a)(Object(ce.a)({},e.rooms),{},Object(ae.a)({},k,y));return Object(ce.a)(Object(ce.a)({},e),{},{rooms:M});case oe:var U,E,C=n.message,S=C.from.userID===F.userID,J=Object(ce.a)({},e.rooms),T=Object(te.a)(e.chats),_=Object(ce.a)({},e.users),P=_[null===(U=C.from)||void 0===U?void 0:U.userID];if(T.push(Object(ce.a)(Object(ce.a)({},C),{},{fromSelf:S})),e.joinedRoomID){var L=Object(ce.a)({},J[e.joinedRoomID]);L.messages.push(Object(ce.a)(Object(ce.a)({},C),{},{fromSelf:S})),J[e.joinedRoomID]=L}return S||(null===(E=e.joinedUser)||void 0===E?void 0:E.userID)===P.userID||(P.messages.hasNewMessages++,P.messages.recent=new Date),Object(ce.a)(Object(ce.a)({},e),{},{rooms:J,chats:T,users:_});case se:var A=n.message,G=[].concat(Object(te.a)(e.chats),[Object(ce.a)({},A)]);return Object(ce.a)(Object(ce.a)({},e),{},{chats:G});case Q:var z,B=n.userID,V=e.users[B],q=(null===(z=e.joinedUser)||void 0===z?void 0:z.userID)===B?null:Object(ce.a)({},V),H=Object(ce.a)({},e.users);return H[B].messages.hasNewMessages=0,Object(ce.a)(Object(ce.a)({},e),{},{users:H,joinedUser:q});case W:var ie=n.user,ue=Object(ce.a)(Object(ce.a)({},e.users),{},Object(ae.a)({},ie.userID,ie)),le=[].concat(Object(te.a)(e.chats),[{content:"".concat(ie.userName,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")}]);return Object(ce.a)(Object(ce.a)({},e),{},{users:ue,chats:le});case K:var de,me=n.userID,be=n.userName,je=Object(te.a)(e.chats),he={},Oe=Object.values(e.users),fe=(null===(de=e.joinedUser)||void 0===de?void 0:de.userID)===me,ge=e.joinedUser,pe="".concat(be,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.");return fe&&(pe="\uadd3\uc18d\ub9d0 \ub300\uc0c1\uc778 ".concat(be,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4."),ge=null),je.push({content:pe}),Oe.forEach((function(e){e.userID!==me&&(he[e.userID]=e)})),Object(ce.a)(Object(ce.a)({},e),{},{chats:je,users:he,joinedUser:ge});case Z:var ve=n.room,De=ve.creater===F.userID?ve.roomID:e.joinedRoomID,Ie=ve.creater===F.userID;ve.isJoined=Ie;var xe=Object(ce.a)(Object(ce.a)({},e.rooms),{},Object(ae.a)({},ve.roomID,ve));return Object(ce.a)(Object(ce.a)({},e),{},{rooms:xe,joinedRoomID:De});case $:var we=n.roomID,Re={};return Object.values(e.rooms).forEach((function(e){e.roomID!==we&&(Re[e.roomID]=e)})),Object(ce.a)(Object(ce.a)({},e),{},{rooms:Re});default:return e}}var le=l.a.main(H||(H=Object(i.a)(["\n  width: 100%;\n  height: 100%;\n"]))),de=function(){var e=Object(r.useState)(!1),n=Object(u.a)(e,2),o=n[0],s=function(e){var n=Object(r.useReducer)(ue,ie),o=Object(u.a)(n,2),s=o[0],t=o[1],a=s.joinedRoomID,c=Object(r.useCallback)((function(){F.emit("go loby")}),[]),i=Object(r.useCallback)((function(e){e!==F.userID&&t({type:Q,userID:e})}),[]),l=Object(r.useCallback)((function(e){var n=e.content,o=e.roomID;F.emit("room message",{content:n,roomID:o})}),[]),d=Object(r.useCallback)((function(e){F.emit("private message",e)}),[]),m=Object(r.useCallback)((function(e){F.emit("public message",e)}),[]),b=Object(r.useCallback)((function(){F.emit("create room")}),[]),j=Object(r.useCallback)((function(e){F.emit("join room",e)}),[]),h=Object(r.useCallback)((function(e){t({type:ee,roomID:e})}),[]),O=Object(r.useCallback)((function(e){F.emit("leave room",e)}),[]),f=Object(r.useCallback)((function(n){e(!0),F.auth={userName:n},F.connect()}),[e]);return Object(r.useEffect)((function(){return F.on("session",(function(e){F.userID=e})),F.on("users rooms",(function(e){var n=e.users,o=e.rooms;t({type:ne,users:n,rooms:o})})),F.on("join room",(function(e){var n=e.roomUsers,o=e.userID,s=e.userName,r=e.roomID;t({type:Y,roomUsers:n,userID:o,userName:s,roomID:r})})),F.on("leave room",(function(e){var n=e.roomUsers,o=e.userID,s=e.userName,r=e.roomID,a=e.users,c=e.rooms;t({type:X,roomUsers:n,userID:o,userName:s,roomID:r,users:a,rooms:c})})),F.on("room message",(function(e){var n=e.message,o=e.roomID;t({type:re,message:n,roomID:o})})),F.on("private message",(function(e){t({type:oe,message:e})})),function(){F.disconnect()}}),[]),Object(r.useEffect)((function(){return a||(F.on("room created",(function(e){t({type:Z,room:e})})),F.on("delete room",(function(e){t({type:$,roomID:e})})),F.on("public message",(function(e){t({type:se,message:e})})),F.on("user connected",(function(e){t({type:W,user:e})})),F.on("user disconnected",(function(e){var n=e.userID,o=e.userName;t({type:K,userID:n,userName:o})}))),function(){F.off("room created"),F.off("delete room"),F.off("public message"),F.off("user connected"),F.off("user disconnected")}}),[a]),{state:s,handleGoLoby:c,handleEnterRoom:h,handleToggleJoinedUser:i,handleSendRoomMessage:l,handleSendPrivateMessage:d,handleSendPublicMessage:m,handleCreateRoom:b,handleJoinRoom:j,handleLeaveRoom:O,handleConnectSocket:f}}(n[1]),t=s.state,a=t.chats,c=t.users,i=t.rooms,l=t.joinedRoomID,m=t.joinedUser,b=Object(r.useCallback)((function(e){return m?s.handleSendPrivateMessage({content:e,to:m}):l?s.handleSendRoomMessage({content:e,roomID:l}):s.handleSendPublicMessage(e)}),[m,l]);return Object(d.jsx)("div",{className:"app",children:Object(d.jsxs)(le,{children:[!o&&Object(d.jsx)(A,{connectSocket:s.handleConnectSocket}),o&&l&&Object(d.jsx)(V,{joinedRoom:i[l],joinedUser:m,leaveRoom:s.handleLeaveRoom,goLoby:s.handleGoLoby,toggleJoinedUser:s.handleToggleJoinedUser,sendMessage:b}),o&&!l&&Object(d.jsx)(_,{users:c,chats:a,rooms:i,joinedUser:m,toggleJoinedUser:s.handleToggleJoinedUser,joinRoom:s.handleJoinRoom,enterRoom:s.handleEnterRoom,createRoom:s.handleCreateRoom,sendMessage:b})]})})};c.a.render(Object(d.jsx)(de,{}),document.getElementById("root"))}},[[88,1,2]]]);
//# sourceMappingURL=main.5853ffca.chunk.js.map