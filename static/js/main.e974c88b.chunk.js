(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{52:function(e,n,t){},87:function(e,n,t){},88:function(e,n,t){"use strict";t.r(n);var s=t(0),o=t(43),r=t.n(o),c=t(3),a=t(2),i=(t(52),t(4)),u=t(5);var l=t(13),b=t(11),m=t(44),d=Object(m.io)("https://web-chat-sangmin-server.herokuapp.com/web-chat",{autoConnect:!1});d.onAny((function(e){}));var f,j,O=t(1),v=i.a.section(f||(f=Object(c.a)(["\n  width: 300px;\n  position: relative;\n  top: 30%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n\n  h2 {\n    text-align: center;\n  }\n  form {\n    border-bottom: 1px solid #222;\n    input {\n      display: inline-block;\n      width: 80%;\n      border: 0;\n      outline: none;\n      padding: 0.1rem 0.3rem;\n    }\n    button {\n      display: inline-block;\n      width: 20%;\n      padding: 0.1rem 0.3rem;\n      border: 0;\n      background: #222;\n      border-radius: 3px 3px 0 0;\n      color: #eee;\n    }\n  }\n"]))),g=function(e){var n=e.setLogin,t=Object(s.useRef)(null),o=function(e){var n=e.setLogin;return{connectSocekt:Object(s.useCallback)((function(e){n(!0),d.auth={userName:e},d.connect()}),[n])}}({setLogin:n}).connectSocekt,r=Object(s.useCallback)((function(e){var n;e.preventDefault();var s=null===t||void 0===t||null===(n=t.current)||void 0===n?void 0:n.value;s&&o(s)}),[o,t]);return Object(O.jsxs)(v,{children:[Object(O.jsx)("h2",{children:"Web Chat"}),Object(O.jsxs)("form",{onSubmit:r,children:[Object(O.jsx)("input",{ref:t,type:"text",autoComplete:"off",placeholder:"user name..."}),Object(O.jsx)("button",{children:"\uc785\uc7a5"})]})]})};var h,p,x,D,I,k,w,C,M,N,y=i.a.article(j||(j=Object(c.a)(["\n  width : calc(98% / 3);\n  @media screen and (max-width: 600px) {\n    width: calc(98% / 2);\n  }\n  height : fit-content;\n  border : 1px solid;\n  border-color : ","}\n  border-radius : 3px;\n  margin-right : 1%;\n  padding : .2rem .4rem;\n  cursor : pointer;\n  * {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n  }\n  .room-info {\n    display : flex;\n    justify-content : space-between;\n    .room-hasNewMessages {\n      background-color: purple;\n      padding: 0.1rem 0.3rem;\n      border-radius: 3px;\n      font-size: 0.85rem;\n      color : white;\n    }\n  }\n"])),(function(e){return e.isJoined?"tomato":"#444"})),R=function(e){var n=e.room,t=e.enterRoom,o=e.joinRoom,r=Object(s.useCallback)((function(){if(n.isJoined)return t(n.roomID);o(n.roomID)}),[t,o,n]),c=Object(s.useMemo)((function(){return n.isJoined?[n.users[0].userName,n.users.length<2?null:n.users.length-1]:[null,null]}),[n.users,n.isJoined]),a=Object(u.a)(c,2),i=a[0],l=a[1];return Object(O.jsxs)(y,{className:"room",isJoined:n.isJoined,onClick:r,children:[Object(O.jsx)("div",{className:"room-name",children:n.roomName}),n.isJoined&&Object(O.jsxs)("div",{className:"room-info",children:[Object(O.jsxs)("div",{className:"room-users",children:[i," ",l&&"+".concat(l)]}),0!==n.hasNewMessages&&Object(O.jsx)("div",{className:"room-hasNewMessages",children:n.hasNewMessages})]}),!n.isJoined&&Object(O.jsx)("div",{children:"\ub300\ud654\ubc29\uc5d0 \ucc38\uc5ec\ud558\uc138\uc694!"})]})},U=i.a.section(h||(h=Object(c.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: 40%;\n  }\n"]))),S=i.a.section(p||(p=Object(c.a)(["\n  height: 60%;\n  padding: 0.5rem;\n  .created-rooms {\n    height: calc(99% - 30.1px);\n    padding-top: 0.5rem;\n    display: flex;\n    flex-wrap: wrap;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n"]))),E=function(e){var n=e.chats,t=e.rooms,o=e.setRooms,r=e.setRoom,c=e.emitMessage,i=e.users,u=e.interfaceLayout,m=function(e){var n=e.setUsers,t=e.setChat,o=e.selectedUser,r=e.setSelectedUser,c=e.setRooms,i=(e.rooms,Object(s.useCallback)((function(e){var n=e.content;d.emit("public message",n)}),[])),u=Object(s.useCallback)((function(){d.emit("create room")}),[]),m=Object(s.useCallback)((function(e){d.emit("join room",e)}),[]);Object(s.useEffect)((function(){return d.on("user connected",(function(e){n((function(n){return Object(a.a)(Object(a.a)({},n),{},Object(b.a)({},e.userID,e))})),t((function(n){var t={content:"".concat(e.userName,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")};return[].concat(Object(l.a)(n),[t])}))})),d.on("user disconnected",(function(e){var s=e.userID,c=e.userName,a=(null===o||void 0===o?void 0:o.userID)===s,i="".concat(c,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.");a&&(i="\uadd3\uc18d\ub9d0 \ub300\uc0c1\uc778 ".concat(c,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4."),r(null)),t((function(e){var n={content:i};return[].concat(Object(l.a)(e),[n])})),n((function(e){var n={};return Object.values(e).forEach((function(e){e.userID!==s&&(n[e.userID]=e)})),n}))})),d.on("public message",(function(e){t((function(n){var t=Object(a.a)({},e);return[].concat(Object(l.a)(n),[t])}))})),function(){d.off("user connected"),d.off("user disconnected"),d.off("public message")}}),[t,n,r,o]);var f=Object(s.useCallback)((function(e){c((function(n){return e.creater===d.userID&&m(e.roomID),Object(a.a)(Object(a.a)({},n),{},Object(b.a)({},e.roomID,e))}))}),[]),j=Object(s.useCallback)((function(e){c((function(n){var t={};return Object.values(n).forEach((function(n){n.roomID!==e&&(t[n.roomID]=n)})),t}))}),[c]);return Object(s.useEffect)((function(){return d.on("room created",(function(e){f(e)})),d.on("delete room",(function(e){j(e)})),function(){d.off("room created"),d.off("delete room")}}),[f,j]),{sendPublicMessage:i,createRoom:u,joinRoom:m}}(e),f=Object(s.useCallback)((function(e){c(m.sendPublicMessage,{content:e})}),[c,m]),j=Object(s.useCallback)((function(e){var n=Object(a.a)({},t);n[e]=Object(a.a)(Object(a.a)({},t[e]),{},{hasNewMessages:0}),o(n),r(e)}),[t,r,o]),v=Object(s.useMemo)((function(){return Object.values(t).sort((function(e,n){return e.isJoined?-1:0}))}),[t]),g=Object(s.useMemo)((function(){return Object.values(i).sort((function(e,n){return e.self?-1:n.self?1:e.messages.recent>n.messages.recent?-1:0}))}),[i]);return Object(O.jsx)(U,{children:Object(s.cloneElement)(u,{chats:n,iterableUsers:g,emitMessageHandler:f},Object(O.jsxs)(S,{children:[Object(O.jsx)("section",{className:"button-container",children:Object(O.jsx)("button",{onClick:m.createRoom,children:"\ubc29 \ub9cc\ub4e4\uae30"})}),Object(O.jsx)("section",{className:"created-rooms",children:v.map((function(e){return Object(O.jsx)(R,{room:e,enterRoom:j,joinRoom:m.joinRoom},e.roomID)}))})]}))})},L=i.a.section(x||(x=Object(c.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: calc(100% - 46.1px);\n  }\n"]))),P=i.a.section(D||(D=Object(c.a)(["\n  padding: 0.5rem;\n  height: fit-content;\n"]))),J=function(e){var n=e.setRoom,t=e.interfaceLayout,o=e.emitMessage,r=e.selectedRoom,c=e.leaveRoom,a=e.sendRoomMessage,i=e.goLoby,u=Object(s.useMemo)((function(){return r.roomID}),[r.roomID]),l=Object(s.useCallback)((function(e){o(a,{content:e,roomID:u})}),[o,a,u]),b=Object(s.useCallback)((function(){n(null),i()}),[n,i]),m=Object(s.useCallback)((function(){c(u),i()}),[c,u,i]);return Object(O.jsx)(L,{children:Object(s.cloneElement)(t,{chats:r.messages,iterableUsers:r.users,emitMessageHandler:l},Object(O.jsx)(P,{children:Object(O.jsxs)("div",{className:"button-container",children:[Object(O.jsx)("button",{onClick:m,children:"\ub098\uac00\uae30"}),Object(O.jsx)("button",{onClick:b,children:"\ub85c\ube44\ub85c \uc774\ub3d9"})]})}))})},H=i.a.article(I||(I=Object(c.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-item: center;\n  ",";\n  padding: 0.2rem 0.4rem;\n  .messages-hasNewMessages {\n    background-color: purple;\n    padding: 0.1rem 0.3rem;\n    border-radius: 3px;\n    font-size: 0.85rem;\n  }\n"])),(function(e){return e.isTarget?"background-color : #fff; color : black":"background-color : transparent; color : #f2f2f2"})),z=function(e){var n=e.user,t=e.togglePrivateMessage,o=e.selectedUser,r=Object(s.useCallback)((function(){n.userID&&t(n.userID)}),[t,n]);return Object(O.jsxs)(H,{isTarget:n.userID===(null===o||void 0===o?void 0:o.userID),onClick:r,children:[Object(O.jsx)("div",{className:"user-name",children:n.userName}),n.messages&&0!==n.messages.hasNewMessages&&Object(O.jsx)("div",{className:"messages-hasNewMessages",children:n.messages.hasNewMessages})]})},T=i.a.article(k||(k=Object(c.a)(["\n  width: 100%;\n  position: relative;\n  text-align: left;\n  color: ",";\n  cursor: ",";\n"])),(function(e){return["green","black","purple"][e.type]}),(function(e){return 2===e.type?"pointer":"normal"})),q=function(e){var n=e.content,t=e.from,o=e.to,r=e.fromSelf,c=e.togglePrivateMessage,a=Object(s.useMemo)((function(){return o||t?o?r?["\ub2f9\uc2e0\uc774 ".concat(o.userName,"\uc5d0\uac8c"),2]:r?[null,1]:["".concat(null===t||void 0===t?void 0:t.userName,"\ub2d8\uc774 \ub2f9\uc2e0\uc5d0\uac8c"),2]:[null===t||void 0===t?void 0:t.userName,1]:["\uacf5\uc9c0",0]}),[t,o,r]),i=Object(u.a)(a,2),l=i[0],b=i[1],m=Object(s.useCallback)((function(){if(o&&t){var e=r?o.userID:t.userID;c(e)}}),[c,r,t,o]);return Object(O.jsxs)(T,{type:b,onClick:m,children:[Object(O.jsx)("b",{children:l})," : ",n]})},A=i.a.section(w||(w=Object(c.a)(["\n  display: flex;\n  flex-direction: column;\n  .chats {\n    position: relative;\n    width: 100%;\n    height: calc(100% - 36.1px);\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-end;\n    padding: 0.4rem;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n  form {\n    position: relative;\n    width: 100%;\n    height: 36px;\n    background: #222;\n    display: flex;\n    align-items: center;\n    b {\n      display: inline-block;\n      width: 20%;\n      background-color: #222;\n      border-radius: 6px 0 0 6px;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      white-space: nowrap;\n      color: #fff;\n      padding-left: 0.3rem;\n      &.private-message {\n        color: rgba(245, 81, 226, 1);\n      }\n    }\n    input {\n      border: 0;\n      width: 70%;\n      padding: 0.2rem 0.4rem;\n      outline: none;\n      border-radius: 6px;\n    }\n    button {\n      border: 0;\n      background: none;\n      width: 10%;\n      color: #fff;\n      cursor: pointer;\n    }\n    * {\n      font-size: 0.9rem;\n    }\n  }\n"]))),B=function(e){var n=e.chats,t=e.emitMessage,o=e.selectedUser,r=e.togglePrivateMessage,c=Object(s.useRef)(null),i=Object(s.useCallback)((function(e){var n;e.preventDefault();var s=null===c||void 0===c||null===(n=c.current)||void 0===n?void 0:n.value;s&&(t(s),e.target[0].value="")}),[t]),u=Object(s.useCallback)((function(){var e,n=null!==(e=null===o||void 0===o?void 0:o.userID)&&void 0!==e?e:null;r(n)}),[r,o]);return Object(s.useEffect)((function(){var e=document.querySelector(".chats");null===e||void 0===e||e.scrollTo(0,e.scrollHeight)}),[n]),Object(O.jsxs)(A,{className:"chat-area",children:[Object(O.jsx)("div",{className:"chats",children:n.map((function(e,n){return Object(O.jsx)(q,Object(a.a)(Object(a.a)({},e),{},{togglePrivateMessage:r}),"chat ".concat(n))}))}),Object(O.jsxs)("form",{onSubmit:i,children:[o&&Object(O.jsxs)("b",{className:"private-message",onClick:u,children:[o.userName," \uc5d0\uac8c"]}),!o&&Object(O.jsx)("b",{children:"\ubaa8\ub450\uc5d0\uac8c"}),Object(O.jsx)("input",{ref:c,type:"text"}),Object(O.jsx)("button",{children:"\uc785\ub825"})]})]})},F=i.a.section(C||(C=Object(c.a)(["\n  width: 20%;\n  height: 100%;\n  overflow-y: scroll;\n  scrollbar-width: none;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  background: #222;\n"]))),W=i.a.section(M||(M=Object(c.a)(["\n  width: 80%;\n  height : 100%;\n  display: flex;\n  flex-direction: column;\n  .button-container {\n    display : flex;\n    justify-content : flex-end;\n    height : 30px;\n    button {\n      display: inline-block;\n      width: fit-content;\n      background: transparent;\n      border 1px solid #666;\n      border-radius : 3px;\n      padding : .1rem .3rem;\n      cursor : pointer;\n      margin-left : .3rem;\n    }\n  }\n"]))),G=function(e){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(F,{className:"users",children:e.iterableUsers.map((function(n){return Object(O.jsx)(z,{user:n,togglePrivateMessage:e.togglePrivateMessage,selectedUser:e.selectedUser},n.userID)}))}),Object(O.jsxs)(W,{children:[e.children,Object(O.jsx)(B,{chats:e.chats,emitMessage:e.emitMessageHandler,selectedUser:e.selectedUser,togglePrivateMessage:e.togglePrivateMessage})]})]})},K=(t(87),function(){return Object(O.jsx)("div",{className:"lds-spinner-wrap",children:Object(O.jsxs)("div",{className:"lds-spinner",children:[Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{}),Object(O.jsx)("div",{})]})})});var Q=i.a.main(N||(N=Object(c.a)(["\n  width: 100%;\n  height: 100%;\n"]))),V=function(){var e=function(){var e=Object(s.useState)(!1),n=Object(u.a)(e,2),t=n[0],o=n[1];return{isLogin:t,setLogin:Object(s.useCallback)((function(e){o(e)}),[o])}}(),n=e.isLogin,t=e.setLogin,o=function(){var e=Object(s.useState)({}),n=Object(u.a)(e,2);return{users:n[0],setUsers:n[1]}}(),r=o.users,c=o.setUsers,i=function(){var e=Object(s.useState)(null),n=Object(u.a)(e,2),t=n[0],o=n[1];return{room:t,setRoom:Object(s.useCallback)((function(e){o(e)}),[o])}}(),m=i.room,f=i.setRoom,j=function(){var e=Object(s.useState)({}),n=Object(u.a)(e,2);return{rooms:n[0],setRooms:n[1]}}(),v=j.rooms,h=j.setRooms,p=function(){var e=Object(s.useState)([]),n=Object(u.a)(e,2);return{chats:n[0],setChat:n[1]}}(),x=p.chats,D=p.setChat,I=function(){var e=Object(s.useState)(null),n=Object(u.a)(e,2),t=n[0],o=n[1];return{selectedUser:t,setSelectedUser:Object(s.useCallback)((function(e){o(e)}),[o])}}(),k=I.selectedUser,w=I.setSelectedUser,C=Object(s.useCallback)((function(e){f(e),w(null)}),[w,f]),M=function(e){var n=e.setUsers,t=e.setRooms,o=e.room,r=e.setRoom,c=e.setChat,i=e.selectedUser,u=Object(s.useCallback)((function(e){r(null),t((function(n){var t={};return Object.values(n).forEach((function(n){n.roomID!==e&&(t[n.roomID]=n)})),t})),d.emit("leave room",e)}),[r,t]),m=Object(s.useCallback)((function(){d.emit("go loby")}),[]),f=Object(s.useCallback)((function(e){var n=e.content,t=e.roomID;d.emit("room message",{content:n,roomID:t})}),[]),j=Object(s.useCallback)((function(e){d.emit("private message",e)}),[]);Object(s.useEffect)((function(){return d.on("users",(function(e){var t={};e.forEach((function(e){e.self=!1,e.userID===d.userID&&(e.self=!0),t[e.userID]=e})),n(t)})),d.on("rooms",(function(e){var n={};e.forEach((function(e){return n[e.roomID]=e})),t(n)})),d.on("go loby",(function(e){var s=e.newUsers,o=e.newRooms;t((function(e){var n={};return o.forEach((function(t){e[t.roomID]&&(n[t.roomID]=e[t.roomID]),e[t.roomID]||(n[t.roomID]=t)})),n})),n((function(e){var n={};return s.forEach((function(t){e[t.userID]&&(n[t.userID]=e[t.userID]),e[t.userID]||(n[t.userID]=t)})),n}))})),function(){d.off("users"),d.off("rooms"),d.off("go loby")}}),[t,n]);var O=Object(s.useCallback)((function(e){var n=e.roomUsers,s=e.userID,o=e.userName,c=e.roomID;t((function(e){var t=Object(a.a)({},e[c]),i=d.userID===s;t.isJoined=!0;var u=n.map((function(e){return e.self=!1,e.userID===d.userID&&(e.self=!0),e}));t.users=u,t.messages.push({content:"".concat(o,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")});var l=Object(a.a)(Object(a.a)({},e),{},Object(b.a)({},c,t));return i&&r(c),l}))}),[r,t]),v=Object(s.useCallback)((function(e){var n=e.roomUsers,s=e.userName,o=e.roomID;t((function(e){var t=Object(a.a)({},e[o]);if(t)return t.users=n,t.messages.push({content:"".concat(s,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")}),Object(a.a)(Object(a.a)({},e),{},Object(b.a)({},o,t))}))}),[t]),g=Object(s.useCallback)((function(e){var n=e.message,s=e.roomID;t((function(e){var t=Object(a.a)({},e[s]);return t.messages.push(n),o||t.hasNewMessages++,Object(a.a)(Object(a.a)({},e),{},Object(b.a)({},s,t))}))}),[t,o]);Object(s.useEffect)((function(){return d.on("join room",(function(e){var n=e.roomUsers,t=e.userID,s=e.userName,o=e.roomID;O({roomUsers:n,userID:t,userName:s,roomID:o})})),d.on("leave room",(function(e){var n=e.roomUsers,t=e.userName,s=e.roomID;v({roomUsers:n,userName:t,roomID:s})})),d.on("room message",(function(e){var n=e.message,t=e.roomID;g({message:n,roomID:t})})),function(){d.off("join room"),d.off("leave room"),d.off("room message")}}),[O,v,g]);var h=Object(s.useCallback)((function(e,n){c((function(t){var s=Object(a.a)(Object(a.a)({},n),{},{fromSelf:e});return[].concat(Object(l.a)(t),[s])})),o&&t((function(t){var s=Object(a.a)({},t);return s[o].messages.push(Object(a.a)(Object(a.a)({},n),{},{fromSelf:e})),s}))}),[t,c,o]),p=Object(s.useCallback)((function(e){n((function(n){var t=Object(a.a)({},n),s=t[e.from.userID];return(null===i||void 0===i?void 0:i.userID)!==s.userID&&(s.messages.hasNewMessages++,s.messages.recent=new Date),t}))}),[n,i]);return Object(s.useEffect)((function(){return d.on("private message",(function(e){var n=e.from.userID===d.userID;h(n,e),n||p(e)})),function(){d.off("private message")}}),[h,p]),Object(s.useEffect)((function(){return d.on("session",(function(e){d.userID=e})),function(){d.disconnect()}}),[]),{sendRoomMessage:f,sendPrivateMessage:j,leaveRoom:u,goLoby:m}}({users:r,setUsers:c,rooms:v,setRooms:h,room:m,setRoom:C,setChat:D,selectedUser:k}),N=Object(s.useMemo)((function(){if(m)return v[m]}),[v,m]),y=Object(s.useCallback)((function(e,n){k&&M.sendPrivateMessage({content:n.content,to:k}),k||e(n)}),[k,M]),R=Object(s.useCallback)((function(e){var n,t=null!==(n=r[e])&&void 0!==n?n:null;if(!t)return w(null);if(!t.self){var s=(null===k||void 0===k?void 0:k.userID)===t.userID?null:Object(a.a)({},t),o=Object(a.a)({},r);o[t.userID].messages.hasNewMessages=0,w(s),c(o)}}),[w,k,r,c]),U=Object(O.jsx)(G,{selectedUser:k,togglePrivateMessage:R,users:r,setUsers:c,setSelectedUser:w}),S=Object(s.useMemo)((function(){return Object.values(r).length}),[r]);return Object(O.jsxs)("div",{className:"app",children:[n&&0===S&&Object(O.jsx)(K,{}),Object(O.jsxs)(Q,{children:[!n&&Object(O.jsx)(g,{setLogin:t}),n&&N&&Object(O.jsx)(J,{setRoom:C,interfaceLayout:U,emitMessage:y,selectedRoom:N,leaveRoom:M.leaveRoom,sendRoomMessage:M.sendRoomMessage,goLoby:M.goLoby}),n&&!N&&r&&Object(O.jsx)(E,{interfaceLayout:U,setRoom:C,selectedUser:k,emitMessage:y,users:r,setUsers:c,setSelectedUser:w,chats:x,setChat:D,setRooms:h,rooms:v})]})]})};r.a.render(Object(O.jsx)(V,{}),document.getElementById("root"))}},[[88,1,2]]]);
//# sourceMappingURL=main.e974c88b.chunk.js.map