(this["webpackJsonpweb-chat"]=this["webpackJsonpweb-chat"]||[]).push([[0],{54:function(e,n,t){},89:function(e,n,t){"use strict";t.r(n);var s=t(0),o=t(42),c=t.n(o),r=t(3),a=t(2),i=(t(54),t(4)),u=t(5);var l=t(11),b=t(43),m=Object(b.io)("https://web-chat-sangmin-server.herokuapp.com/web-chat",{autoConnect:!1});m.onAny((function(e){}));var f=t(49);var d,j,h=t(1),O=i.a.section(d||(d=Object(r.a)(["\n  width: 300px;\n  position: relative;\n  top: 30%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n\n  h2 {\n    text-align: center;\n  }\n  form {\n    border-bottom: 1px solid #222;\n    input {\n      display: inline-block;\n      width: 80%;\n      border: 0;\n      outline: none;\n      padding: 0.1rem 0.3rem;\n    }\n    button {\n      display: inline-block;\n      width: 20%;\n      padding: 0.1rem 0.3rem;\n      border: 0;\n      background: #222;\n      border-radius: 3px 3px 0 0;\n      color: #eee;\n    }\n  }\n"]))),g=function(e){var n=e.setLogin,t=Object(s.useRef)(null),o=function(e){var n=e.setLogin;return{connectSocekt:Object(s.useCallback)((function(e){n(!0),m.auth={userName:e},m.connect()}),[n])}}({setLogin:n}).connectSocekt,c=Object(s.useCallback)((function(e){var n;e.preventDefault();var s=null===t||void 0===t||null===(n=t.current)||void 0===n?void 0:n.value;s&&o(s)}),[o,t]);return Object(h.jsxs)(O,{children:[Object(h.jsx)("h2",{children:"Web Chat"}),Object(h.jsxs)("form",{onSubmit:c,children:[Object(h.jsx)("input",{ref:t,type:"text",autoComplete:"off",placeholder:"user name..."}),Object(h.jsx)("button",{children:"\uc785\uc7a5"})]})]})};var v,p,x,w,D,k,I,C,M,y,N=i.a.article(j||(j=Object(r.a)(["\n  width : calc(98% / 3);\n  @media screen and (max-width: 600px) {\n    width: calc(98% / 2);\n  }\n  height : fit-content;\n  border : 1px solid;\n  border-color : ","}\n  border-radius : 3px;\n  margin-right : 1%;\n  padding : .2rem .4rem;\n  cursor : pointer;\n  * {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n  }\n\n"])),(function(e){return e.isJoined?"tomato":"#444"})),S=function(e){var n=e.room,t=e.enterRoom,o=e.joinRoom,c=Object(s.useCallback)((function(){if(n.isJoined)return t(n.roomID);o(n.roomID)}),[t,o,n]),r=Object(s.useMemo)((function(){return n.isJoined?[n.users[0].userName,n.users.length<2?null:n.users.length-1]:[null,null]}),[n.users,n.isJoined]),a=Object(u.a)(r,2),i=a[0],l=a[1];return Object(h.jsxs)(N,{className:"room",isJoined:n.isJoined,onClick:c,children:[Object(h.jsx)("div",{className:"room-name",children:n.roomName}),n.isJoined&&Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("div",{className:"room-users",children:[i," ",l&&"+".concat(l)]}),0!==n.hasNewMessages&&Object(h.jsx)("div",{className:"room-hasNewMessages",children:n.hasNewMessages})]}),!n.isJoined&&Object(h.jsx)("div",{children:"\ub300\ud654\ubc29\uc5d0 \ucc38\uc5ec\ud558\uc138\uc694!"})]})},R=i.a.section(v||(v=Object(r.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: 40%;\n  }\n"]))),U=i.a.section(p||(p=Object(r.a)(["\n  height: 60%;\n  padding: 0.5rem;\n  .created-rooms {\n    height: calc(99% - 30.1px);\n    padding-top: 0.5rem;\n    display: flex;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n"]))),E=function(e){var n=e.chats,t=e.rooms,o=e.setRooms,c=e.setRoom,r=e.emitMessage,i=e.users,u=e.interfaceLayout,b=function(e){var n=e.users,t=e.setUsers,o=e.setChat,c=e.selectedUser,r=e.setSelectedUser,i=e.roomsDebounce,u=Object(s.useCallback)((function(e){var n=e.content;m.emit("public message",n)}),[]),b=Object(s.useCallback)((function(){m.emit("create room")}),[]),f=Object(s.useCallback)((function(e){m.emit("join room",e)}),[]);Object(s.useEffect)((function(){return m.on("user connected",(function(e){var s=Object(a.a)({},n);s[e.userID]=e,t(s),o({content:"".concat(e.userName,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")})})),m.on("user disconnected",(function(e){var s=e.userID,a=e.userName,i=(null===c||void 0===c?void 0:c.userID)===s,u="".concat(a,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.");i&&(u="\uadd3\uc18d\ub9d0 \ub300\uc0c1\uc778 ".concat(a,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4."),r(null));var l={};Object.values(n).forEach((function(e){e.userID!==s&&(l[e.userID]=e)})),o({content:u}),t(l)})),m.on("public message",(function(e){o(Object(a.a)({},e))})),function(){m.off("user connected"),m.off("user disconnected"),m.off("public message")}}),[o,t,r,n,c]);var d=Object(s.useCallback)((function(e){i.debounceAct((function(){e.creater===m.userID&&f(e.roomID);var n=Object(a.a)(Object(a.a)({},i.newState),{},Object(l.a)({},e.roomID,e));i.newState=n}))}),[i,f]),j=Object(s.useCallback)((function(e){i.debounceAct((function(){var n={};Object.values(i.newState).forEach((function(t){t.roomID!==e&&(n[t.roomID]=t)})),i.newState=n}))}),[i]);return Object(s.useEffect)((function(){return m.on("room created",(function(e){d(e)})),m.on("delete room",(function(e){j(e)})),function(){m.off("room created"),m.off("delete room")}}),[d,j]),{sendPublicMessage:u,createRoom:b,joinRoom:f}}(e),f=Object(s.useCallback)((function(e){r(b.sendPublicMessage,{content:e})}),[r,b]),d=Object(s.useCallback)((function(e){var n=Object(a.a)({},t);n[e]=Object(a.a)(Object(a.a)({},t[e]),{},{hasNewMessages:0}),o(n),c(e)}),[t,c,o]),j=Object(s.useMemo)((function(){return Object.values(t).sort((function(e,n){return e.isJoined?-1:0}))}),[t]),O=Object(s.useMemo)((function(){return Object.values(i).sort((function(e,n){return e.self?-1:n.self?1:e.messages.recent>n.messages.recent?-1:0}))}),[i]);return Object(h.jsx)(R,{children:Object(s.cloneElement)(u,{chats:n,iterableUsers:O,emitMessageHandler:f},Object(h.jsxs)(U,{children:[Object(h.jsx)("section",{className:"button-container",children:Object(h.jsx)("button",{onClick:b.createRoom,children:"\ubc29 \ub9cc\ub4e4\uae30"})}),Object(h.jsx)("section",{className:"created-rooms",children:j.map((function(e){return Object(h.jsx)(S,{room:e,enterRoom:d,joinRoom:b.joinRoom},e.roomID)}))})]}))})},L=i.a.section(x||(x=Object(r.a)(["\n  display: flex;\n  height: 100%;\n  .chat-area {\n    height: calc(100% - 46.1px);\n  }\n"]))),P=i.a.section(w||(w=Object(r.a)(["\n  padding: 0.5rem;\n  height: fit-content;\n"]))),J=function(e){var n=e.setRoom,t=e.interfaceLayout,o=e.emitMessage,c=e.selectedRoom,r=e.leaveRoom,a=e.sendRoomMessage,i=e.goLoby,u=Object(s.useMemo)((function(){return c.roomID}),[c.roomID]),l=Object(s.useCallback)((function(e){o(a,{content:e,roomID:u})}),[o,a,u]),b=Object(s.useCallback)((function(){n(null),i()}),[n,i]),m=Object(s.useCallback)((function(){r(u),i()}),[r,u,i]);return Object(h.jsx)(L,{children:Object(s.cloneElement)(t,{chats:c.messages,iterableUsers:c.users,emitMessageHandler:l},Object(h.jsx)(P,{children:Object(h.jsxs)("div",{className:"button-container",children:[Object(h.jsx)("button",{onClick:m,children:"\ub098\uac00\uae30"}),Object(h.jsx)("button",{onClick:b,children:"\ub85c\ube44\ub85c \uc774\ub3d9"})]})}))})},A=t(47),T=t(48),H=function(){function e(n,t,s){Object(A.a)(this,e),this.timer=void 0,this.newState=void 0,this.setState=void 0,this.arr=[],this.time=0,this.newState=n,this.setState=t,this.time=s}return Object(T.a)(e,[{key:"doWork",value:function(){this.arr.forEach((function(e){e()})),this.setState(this.newState)}},{key:"debounceAct",value:function(e){var n=this;this.timer&&(console.log("work has pushed on workList"),clearTimeout(this.timer)),this.arr.push(e),this.timer=setTimeout((function(){n.doWork(),n.arr=[]}),this.time)}}]),e}(),W=i.a.article(D||(D=Object(r.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-item: center;\n  ",";\n  padding: 0.2rem 0.4rem;\n  .messages-hasNewMessages {\n    background-color: purple;\n    padding: 0.1rem 0.3rem;\n    border-radius: 3px;\n    font-size: 0.85rem;\n  }\n"])),(function(e){return e.isTarget?"background-color : #fff; color : black":"background-color : transparent; color : #f2f2f2"})),z=function(e){var n=e.user,t=e.togglePrivateMessage,o=e.selectedUser,c=Object(s.useCallback)((function(){t(n.userID)}),[t,n]);return Object(h.jsxs)(W,{isTarget:n.userID===(null===o||void 0===o?void 0:o.userID),onClick:c,children:[Object(h.jsx)("div",{className:"user-name",children:n.userName}),n.messages&&0!==n.messages.hasNewMessages&&Object(h.jsx)("div",{className:"messages-hasNewMessages",children:n.messages.hasNewMessages})]})},F=i.a.article(k||(k=Object(r.a)(["\n  width: 100%;\n  position: relative;\n  text-align: left;\n  color: ",";\n  cursor: ",";\n"])),(function(e){return["green","black","purple"][e.type]}),(function(e){return 2===e.type?"pointer":"normal"})),q=function(e){var n=e.content,t=e.from,o=e.to,c=e.fromSelf,r=e.togglePrivateMessage,a=Object(s.useMemo)((function(){return o||t?o?c?["\ub2f9\uc2e0\uc774 ".concat(o.userName,"\uc5d0\uac8c"),2]:c?[null,1]:["".concat(null===t||void 0===t?void 0:t.userName,"\ub2d8\uc774 \ub2f9\uc2e0\uc5d0\uac8c"),2]:[null===t||void 0===t?void 0:t.userName,1]:["\uacf5\uc9c0",0]}),[t,o,c]),i=Object(u.a)(a,2),l=i[0],b=i[1],m=Object(s.useCallback)((function(){if(o&&t){var e=c?o.userID:t.userID;r(e)}}),[r,c,t,o]);return Object(h.jsxs)(F,{type:b,onClick:m,children:[Object(h.jsx)("b",{children:l})," : ",n]})},B=i.a.section(I||(I=Object(r.a)(["\n  display: flex;\n  flex-direction: column;\n  .chats {\n    position: relative;\n    width: 100%;\n    height: calc(100% - 36.1px);\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-end;\n    padding: 0.4rem;\n    overflow-y: scroll;\n    scrollbar-width: none;\n    &::-webkit-scrollbar {\n      display: none;\n    }\n  }\n  form {\n    position: relative;\n    width: 100%;\n    height: 36px;\n    background: #222;\n    display: flex;\n    align-items: center;\n    b {\n      display: inline-block;\n      width: 20%;\n      background-color: #222;\n      border-radius: 6px 0 0 6px;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      white-space: nowrap;\n      color: #fff;\n      padding-left: 0.3rem;\n      &.private-message {\n        color: rgba(245, 81, 226, 1);\n      }\n    }\n    input {\n      border: 0;\n      width: 70%;\n      padding: 0.2rem 0.4rem;\n      outline: none;\n      border-radius: 6px;\n    }\n    button {\n      border: 0;\n      background: none;\n      width: 10%;\n      color: #fff;\n      cursor: pointer;\n    }\n    * {\n      font-size: 0.9rem;\n    }\n  }\n"]))),G=function(e){var n=e.chats,t=e.emitMessage,o=e.selectedUser,c=e.togglePrivateMessage,r=Object(s.useRef)(null),i=Object(s.useCallback)((function(e){var n;e.preventDefault();var s=null===r||void 0===r||null===(n=r.current)||void 0===n?void 0:n.value;s&&(t(s),e.target[0].value="")}),[t]),u=Object(s.useCallback)((function(){var e,n=null!==(e=null===o||void 0===o?void 0:o.userID)&&void 0!==e?e:null;c(n)}),[c,o]);return Object(s.useEffect)((function(){var e=document.querySelector(".chats");null===e||void 0===e||e.scrollTo(0,e.scrollHeight)}),[n]),Object(h.jsxs)(B,{className:"chat-area",children:[Object(h.jsx)("div",{className:"chats",children:n.map((function(e,n){return Object(h.jsx)(q,Object(a.a)(Object(a.a)({},e),{},{togglePrivateMessage:c}),"chat ".concat(n))}))}),Object(h.jsxs)("form",{onSubmit:i,children:[o&&Object(h.jsxs)("b",{className:"private-message",onClick:u,children:[o.userName," \uc5d0\uac8c"]}),!o&&Object(h.jsx)("b",{children:"\ubaa8\ub450\uc5d0\uac8c"}),Object(h.jsx)("input",{ref:r,type:"text"}),Object(h.jsx)("button",{children:"\uc785\ub825"})]})]})},K=i.a.section(C||(C=Object(r.a)(["\n  width: 20%;\n  height: 100%;\n  overflow-y: scroll;\n  scrollbar-width: none;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  background: #222;\n"]))),Q=i.a.section(M||(M=Object(r.a)(["\n  width: 80%;\n  height : 100%;\n  display: flex;\n  flex-direction: column;\n  .button-container {\n    display : flex;\n    justify-content : flex-end;\n    height : 30px;\n    button {\n      display: inline-block;\n      width: fit-content;\n      background: transparent;\n      border 1px solid #666;\n      border-radius : 3px;\n      padding : .1rem .3rem;\n      cursor : pointer;\n      margin-left : .3rem;\n    }\n  }\n"]))),V=function(e){return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(K,{className:"users",children:e.iterableUsers.map((function(n){return Object(h.jsx)(z,{user:n,togglePrivateMessage:e.togglePrivateMessage,selectedUser:e.selectedUser},n.userID)}))}),Object(h.jsxs)(Q,{children:[e.children,Object(h.jsx)(G,{chats:e.chats,emitMessage:e.emitMessageHandler,selectedUser:e.selectedUser,togglePrivateMessage:e.togglePrivateMessage})]})]})};var X=i.a.main(y||(y=Object(r.a)(["\n  width: 100%;\n  height: 100%;\n"]))),Y=function(){var e=function(){var e=Object(s.useState)(!1),n=Object(u.a)(e,2),t=n[0],o=n[1];return{isLogin:t,setLogin:Object(s.useCallback)((function(e){o(e)}),[o])}}(),n=e.isLogin,t=e.setLogin,o=function(){var e=Object(s.useState)({}),n=Object(u.a)(e,2),t=n[0],o=n[1];return{users:t,setUsers:Object(s.useCallback)((function(e){o(e)}),[o])}}(),c=o.users,r=o.setUsers,i=function(){var e=Object(s.useState)(null),n=Object(u.a)(e,2),t=n[0],o=n[1];return{room:t,setRoom:Object(s.useCallback)((function(e){o(e)}),[o])}}(),b=i.room,d=i.setRoom,j=function(){var e=Object(s.useState)({}),n=Object(u.a)(e,2),t=n[0],o=n[1];return{rooms:t,setRooms:Object(s.useCallback)((function(e){o(Object(a.a)({},e))}),[o])}}(),O=j.rooms,v=j.setRooms,p=function(){var e=Object(s.useState)([]),n=Object(u.a)(e,2),t=n[0],o=n[1],c=Object(s.useCallback)((function(e){o([].concat(Object(f.a)(t),[e]))}),[o,t]);return{chats:t,setChat:c}}(),x=p.chats,w=p.setChat,D=function(){var e=Object(s.useState)(null),n=Object(u.a)(e,2),t=n[0],o=n[1];return{selectedUser:t,setSelectedUser:Object(s.useCallback)((function(e){o(e)}),[o])}}(),k=D.selectedUser,I=D.setSelectedUser,C=Object(s.useMemo)((function(){return new H(O,v,0)}),[O,v]),M=Object(s.useCallback)((function(e){d(e),I(null)}),[I,d]),y=function(e){var n=e.users,t=e.setUsers,o=e.rooms,c=e.setRooms,r=e.room,i=e.setRoom,u=e.setChat,b=e.roomsDebounce,f=e.selectedUser,d=Object(s.useCallback)((function(e){i(null);var n={};Object.values(o).forEach((function(t){t.roomID!==e&&(n[t.roomID]=t)})),c(n),m.emit("leave room",e)}),[i,c,o]),j=Object(s.useCallback)((function(){m.emit("go loby")}),[]),h=Object(s.useCallback)((function(e){var n=e.content,t=e.roomID;m.emit("room message",{content:n,roomID:t})}),[]),O=Object(s.useCallback)((function(e){m.emit("private message",e)}),[]);Object(s.useEffect)((function(){return m.on("users",(function(e){var n={};e.forEach((function(e){e.self=!1,e.userID===m.userID&&(e.self=!0),n[e.userID]=e})),t(n)})),m.on("rooms",(function(e){var n={};e.forEach((function(e){return n[e.roomID]=e})),c(n)})),m.on("go loby",(function(e){var s=e.newUsers,r=e.newRooms,a={};r.forEach((function(e){o[e.roomID]&&(a[e.roomID]=o[e.roomID]),o[e.roomID]||(a[e.roomID]=e)}));var i={};s.forEach((function(e){n[e.userID]&&(i[e.userID]=n[e.userID]),n[e.userID]||(i[e.userID]=e)})),c(a),t(i)})),function(){m.off("users"),m.off("rooms"),m.off("go loby")}}),[c,t,o,n]);var g=Object(s.useCallback)((function(e){var n=e.users,t=e.userID,s=e.userName,o=e.roomID;b.debounceAct((function(){var e=Object(a.a)({},b.newState[o]),c=m.userID===t;e.isJoined=!0;var r=n.map((function(e){return e.self=!1,e.userID===m.userID&&(e.self=!0),e}));e.users=r,e.messages.push({content:"".concat(s,"\ub2d8\uc774 \uc785\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")});var u=Object(a.a)(Object(a.a)({},b.newState),{},Object(l.a)({},o,e));b.newState=u,c&&i(o)}))}),[i,b]),v=Object(s.useCallback)((function(e){var n=e.users,t=e.userName,s=e.roomID;b.debounceAct((function(){var e=Object(a.a)({},b.newState[s]);if(e){e.users=n,e.messages.push({content:"".concat(t,"\ub2d8\uc774 \ud1f4\uc7a5\ud558\uc168\uc2b5\ub2c8\ub2e4.")});var o=Object(a.a)(Object(a.a)({},b.newState),{},Object(l.a)({},s,e));b.newState=o}}))}),[b]),p=Object(s.useCallback)((function(e){var n=e.message,t=e.roomID;b.debounceAct((function(){var e=Object(a.a)({},b.newState[t]);e.messages.push(n),r||e.hasNewMessages++;var s=Object(a.a)(Object(a.a)({},b.newState),{},Object(l.a)({},t,e));b.newState=s}))}),[b,r]);Object(s.useEffect)((function(){return m.on("join room",(function(e){var n=e.users,t=e.userID,s=e.userName,o=e.roomID;g({users:n,userID:t,userName:s,roomID:o})})),m.on("leave room",(function(e){var n=e.users,t=e.userName,s=e.roomID;v({users:n,userName:t,roomID:s})})),m.on("room message",(function(e){var n=e.message,t=e.roomID;p({message:n,roomID:t})})),function(){m.off("join room"),m.off("leave room"),m.off("room message")}}),[g,v,p]);var x=Object(s.useCallback)((function(e,n){b.debounceAct((function(){if(u(Object(a.a)(Object(a.a)({},n),{},{fromSelf:e})),r){var t=Object(a.a)({},b.newState);t[r].messages.push(Object(a.a)(Object(a.a)({},n),{},{fromSelf:e})),b.setState(t)}}))}),[b,u,r]),w=Object(s.useCallback)((function(e){b.debounceAct((function(){var s=Object(a.a)({},n),o=s[e.from.userID];(null===f||void 0===f?void 0:f.userID)!==o.userID&&(o.messages.hasNewMessages++,o.messages.recent=new Date),t(s)}))}),[b,n,t,f]);return Object(s.useEffect)((function(){return m.on("private message",(function(e){var n=e.from.userID===m.userID;x(n,e),n||w(e)})),function(){m.off("private message")}}),[x,w]),Object(s.useEffect)((function(){return m.on("session",(function(e){m.userID=e})),function(){m.disconnect()}}),[]),{sendRoomMessage:h,sendPrivateMessage:O,leaveRoom:d,goLoby:j}}({users:c,setUsers:r,rooms:O,setRooms:v,room:b,setRoom:M,setChat:w,roomsDebounce:C,selectedUser:k}),N=Object(s.useMemo)((function(){if(b)return O[b]}),[O,b]),S=Object(s.useCallback)((function(e,n){k&&y.sendPrivateMessage({content:n.content,to:k}),k||e(n)}),[k,y]),R=Object(s.useCallback)((function(e){var n,t=null!==(n=c[e])&&void 0!==n?n:null;if(!t)return I(null);if(!t.self){var s=(null===k||void 0===k?void 0:k.userID)===t.userID?null:Object(a.a)({},t),o=Object(a.a)({},c);o[t.userID].messages.hasNewMessages=0,I(s),r(o)}}),[I,k,c,r]),U=Object(h.jsx)(V,{selectedUser:k,togglePrivateMessage:R,users:c,setUsers:r,setSelectedUser:I});return Object(h.jsx)("div",{className:"app",children:Object(h.jsxs)(X,{children:[!n&&Object(h.jsx)(g,{setLogin:t}),n&&N&&Object(h.jsx)(J,{setRoom:M,interfaceLayout:U,emitMessage:S,selectedRoom:N,leaveRoom:y.leaveRoom,sendRoomMessage:y.sendRoomMessage,goLoby:y.goLoby}),n&&!N&&c&&Object(h.jsx)(E,{interfaceLayout:U,setRoom:M,selectedUser:k,emitMessage:S,users:c,setUsers:r,setSelectedUser:I,chats:x,setChat:w,setRooms:v,rooms:O,roomsDebounce:C})]})})};c.a.render(Object(h.jsx)(Y,{}),document.getElementById("root"))}},[[89,1,2]]]);
//# sourceMappingURL=main.83a44802.chunk.js.map